version: '3.8'

services:
  nbm-ingester:
    build: .
    image: ghcr.io/chancellor1101/nbm-ingester
    container_name: nbm-ingester
    
    environment:
      # Database connection
      DATABASE_URL: ${DATABASE_URL}
      
      # Redis connection (optional)
      REDIS_URL: ${REDIS_URL:-}
      
      # Configuration
      HOT_ZIPS: ${HOT_ZIPS:-5000}
      TMP_DIR: /tmp/nbm
    
    volumes:
      # Optional: mount for logs
      - ./logs:/app/logs
      
      # Optional: mount for persistent temp files (debugging)
      # - ./tmp:/tmp/nbm
    
    restart: "no"  # Run once and exit
    
    # Resource limits (adjust based on your system)
    deploy:
      resources:
        limits:
          cpus: '4'
          memory: 4G
        reservations:
          cpus: '2'
          memory: 2G
    
    # Network (if your DB is in another container)
    # networks:
    #   - wxalerts-network

# Optional: if using docker network
# networks:
#   wxalerts-network:
#     external: true